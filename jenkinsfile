pipeline {
   agent any
   environment {
       registry = "gatreya/repository_01"
       
   }
     stages {
   stage('Publish') {
           environment {
               registryCredential = 'dockerHub'
           }
           steps{
               script {
                   def appimage = docker.build registry + ":$BUILD_NUMBER"
                   docker.withRegistry( '', registryCredential ) {
                       appimage.push()
                       appimage.push('latest')
                   }
               }
           }
       }
       
       stage ('Deploy') {
       steps{
       script{
    def deployment = input message: 'is it new build ', ok: 'Button', parameters: [ booleanParam( defaultValue: false, description: 'just push the button', name: 'yes')]
          
           if (deployment == true) {
          
         
          sh "ssh -T root@3.20.205.215"
           scp "scp -r deployment.yml service.yml /Gourav"
          sh "ssh -T root@3.20.205.215 kubectl create -f deployment.yml"
           
        
           
          }
         else 
         {
          echo "error"
 
            } }
           }
       }
   }}
