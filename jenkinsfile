pipeline {
   agent any
   environment {
       registry = "gatreya/repository_01"
       
   }
     stages {
   stage('Publish') {
           environment {
               registryCredential = 'dockerHub'
           }
           steps{
               script {
                   def appimage = docker.build registry + ":$BUILD_NUMBER"
                   docker.withRegistry( '', registryCredential ) {
                       appimage.push()
                       appimage.push('latest')
                   }
               }
           }
       }
       
       stage ('Deploy') {
       
        steps {
         //  def deployment = input (message: 'is it new build ', ok: 'Button', parameters: [booleanParam(defaultValue: false, description: 'just push the button', name: 'yes')])
           
          // if (deployment == true) {
           
           sh "scp -i deployment.yml service.yml /home/ec2-user"
           
        
           sh "kubectl create -f deployment.yml"
          // }
          // else 
        //   {
         //  echo "error"
            //   script{
              //     def image_id = registry + ":$BUILD_NUMBER"
               //    sh "ansible-playbook  playbook.yml --extra-vars \"image_id=${image_id}\""
          //    }
           }
       }
   }}
